# Vault5 Backend Environment Variables

# Database
MONGO_URI=mongodb://localhost:27017/vault5

# Server
PORT=5000
CORS_ALLOWED_ORIGINS=http://localhost:3000
AUTH_REQUIRE_EMAIL_VERIFICATION=false

# JWT
JWT_SECRET=your_jwt_secret_key_here_make_it_long_and_secure

# Payments (Simulation + Providers)
# Set PAYMENTS_FORCE_SIMULATION=true to force simulation provider in dev even if provider=mpesa/airtel is requested
PAYMENTS_FORCE_SIMULATION=true
# Auto-confirm simulation after N ms (set to false to disable)
SIMULATE_SUCCESS_DELAY_MS=6000
SIMULATE_AUTO_CONFIRM=true

# M-Pesa Daraja (Sandbox/Production)
MPESA_ENV=sandbox
MPESA_CONSUMER_KEY=your_daraja_consumer_key
MPESA_CONSUMER_SECRET=your_daraja_consumer_secret
MPESA_SHORTCODE=174379
MPESA_PASSKEY=your_lipa_na_mpesa_passkey
MPESA_C2B_CALLBACK_URL=http://localhost:5000/api/payments/providers/mpesa/callback
# Optional validation/confirmation endpoints if using C2B registration flows
MPESA_C2B_VALIDATION_URL=http://localhost:5000/api/payments/providers/mpesa/validation
MPESA_C2B_CONFIRMATION_URL=http://localhost:5000/api/payments/providers/mpesa/confirmation
# B2C (when enabling payouts)
MPESA_B2C_SHORTCODE=600000
MPESA_INITIATOR_NAME=apitest
MPESA_INITIATOR_PASSWORD=your_initiator_password_or_security_credential
MPESA_B2C_RESULT_URL=http://localhost:5000/api/payments/providers/mpesa/b2c/result
MPESA_B2C_TIMEOUT_URL=http://localhost:5000/api/payments/providers/mpesa/b2c/timeout

# Airtel Money (Sandbox/Production)
AIRTEL_ENV=sandbox
AIRTEL_CLIENT_ID=your_airtel_client_id
AIRTEL_CLIENT_SECRET=your_airtel_client_secret
AIRTEL_CALLBACK_URL=http://localhost:5000/api/payments/providers/airtel/callback

# AWS Secrets Manager Configuration
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_SECRETS_NAME=vault5/prod

# Plaid API Configuration
PLAID_CLIENT_ID=your_plaid_client_id
PLAID_SECRET=your_plaid_secret
PLAID_ENV=sandbox

# Other (for future)
NODE_ENV=development

# Loans v2 P2P configuration defaults (MVP)
# Thresholds and policy
LOANS_2FA_THRESHOLD=10000          # KES; require 2FA at or above this principal
LOANS_DAILY_LIMIT=1                # Max new loan requests per borrower per day
LOANS_COOLING_HOURS=48             # Borrower cooling-off window prior to lender approval
LOANS_GRACE_DAYS=3                 # Grace period before marking overdue
LOANS_MAX_RETRY=3                  # Auto-deduction retry attempts
LOANS_RETRY_BACKOFF_HOURS=24       # Hours between retries
DEFAULT_CURRENCY=KES               # Default currency code
DEFAULT_LOAN_INTEREST=0            # Default interest rate for P2P loans unless specified (decimal)

# Note: Production secrets are injected via AWS Secrets Manager
# The following secrets will be loaded from AWS:
# - MONGO_URI
# - JWT_SECRET
# - PLAID_CLIENT_ID
# - PLAID_SECRET
# - MPESA_* and AIRTEL_* where applicable
# - Any other sensitive credentials
# --- Wallet Rules & Migration Toggles ---

# Run one-time migration to 5-account model (removes Charity, sets: Daily 50, Emergency 10, Investment 20, LongTerm 10, Fun 10)
# Set to true only for a controlled run, then switch back to false after migration completes
MIGRATE_FIVE_ACCOUNTS=false

# Discipline engine defaults (can be overridden per user in future phases)

# Daily account
DAILY_AI_ALERT_THRESHOLD_PCT=20

# Fun account
FUN_SWEEP_ENABLED=true
FUN_SWEEP_DAY=last_day  # last_day or a day number (1..28) for monthly sweep to LongTerm
FUN_NO_INTERNAL_OUT=true

# Emergency account
EMERGENCY_EXTERNAL_ONLY=true
EMERGENCY_DELAY_HOURS=24
EMERGENCY_MAX_WITHDRAWALS_PER_MONTH=2
EMERGENCY_AI_CONFIRM_REQUIRED=true

# Long-Term account
LONGTERM_LOCK_MONTHS_DEFAULT=0   # 0|3|6|12 (0 means no lock by default)
LONGTERM_EARLY_PENALTY_PCT=0.03  # 3% penalty if locked and withdrawn early
LONGTERM_REWARD_ENABLED=true

# Investments (savings bucket)
INVESTMENTS_LOCK_DAYS=90
INVESTMENTS_MIN_WITHDRAWAL=50
INVESTMENTS_EXTERNAL_ONLY=true

# Cross-account fee
SAVINGS_TO_DAILY_FEE_PCT=0.01    # 1% fee when moving from Emergency/LongTerm/Investment to Daily